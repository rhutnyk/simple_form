<div>
    <div class="row" ng-form="$ctrl.auditForm">

        <h3 class="ch-title rounded">Brand Image Audit</h3>

        <div class="panel panel-default">
            <div class="panel-body">
                <div class="col-sm-4">
                    <p class="text-muted">Audit #</p>
                    <p class="text-primary">{{$ctrl.info.Id}}</p>
                </div>
                <div class="col-sm-4">
                    <p class="text-muted">Scheduled for</p>
                    <p class="text-primary">{{$ctrl.info.ScheduledDate | date}}</p>
                </div>
                <div class="col-sm-4">
                    <p class="text-muted">Status:</p>
                    <p class="text-primary">{{$ctrl.status}}</p>
                </div>
                <div class="clear"></div>
                <div>
                    <hr />
                    <div class="col-sm-4" ng-class="{ 'has-error' : $ctrl.auditForm.manager.$invalid && ($ctrl.auditForm.manager.$touched || $ctrl.auditForm.submitted) }">
                        <p class="text-muted">Manager</p>
                        <!--<span ng-show="$ctrl.processing['manager']" class="load-indicator glyphicon glyphicon-refresh" aria-hidden="true"></span>
                        <select ng-model="$ctrl.manager" class="form-control" ng-init="$ctrl.getData('manager');" required name="manager" ng-disabled="!($ctrl.status == 'New' || $ctrl.status == 'InProgress')"
                                ng-options="option.EmplCode as option.Name for option in $ctrl.resources['manager']"
                                ng-change="$ctrl.onchange('managerchange', $ctrl.manager)">
                            <option value="">select...</option>
                        </select>-->

                        <div ng-init="$ctrl.setAutocomplete('manager', 'manager')">
                            <md-autocomplete required
                                             md-input-name="manager"
                                             ng-disabled="!($ctrl.status == 'New' || $ctrl.status == 'InProgress')"
                                             md-search-text="$ctrl.autocomplete['manager']"
                                             md-selected-item-change="$ctrl.manager = item.DisplayName; $ctrl.onchange('managerchange', $ctrl.manager)"
                                             md-no-cache="true"
                                             md-items="item in $ctrl.getDataOptions('employees','DisplayName', $ctrl.autocomplete['manager'], 'manager')"
                                             md-item-text="item.DisplayName"
                                             md-min-length="0"
                                             placeholder="Manager">
                                <md-item-template>
                                    <span md-highlight-text="$ctrl.autocomplete['manager'].toUpperCase()">{{item.Name}} ({{item.EmplCode}})</span>
                                </md-item-template>
                                <md-not-found>
                                    No manager matching "{{$ctrl.autocomplete['manager']}}" were found.
                                </md-not-found>
                            </md-autocomplete>
                        </div>

                    </div>
                    <div class="col-sm-4" ng-class="{ 'has-error' : $ctrl.auditForm.fleetManager.$invalid && ($ctrl.auditForm.fleetManager.$touched || $ctrl.auditForm.submitted) }">
                        <p class="text-muted">Fleet Manager</p>
                        <!--<span ng-show="$ctrl.processing['fleetmanager']" class="load-indicator glyphicon glyphicon-refresh" aria-hidden="true"></span>
                        <select ng-model="$ctrl.fleetManager" class="form-control" ng-init="$ctrl.getData('fleetmanager');" required name="fleetManager" ng-disabled="!($ctrl.status == 'New' || $ctrl.status == 'InProgress')"
                                ng-options="option.EmplCode as option.Name for option in $ctrl.resources['fleetmanager']"
                                ng-change="$ctrl.onchange('fleetmanagerchange', $ctrl.fleetManager)">
                            <option value="">select...</option>
                        </select>-->

                        <div ng-init="$ctrl.setAutocomplete('fleetManager', 'fleetManager')">
                            <md-autocomplete required
                                             md-input-name="fleetManager"
                                             ng-disabled="!($ctrl.status == 'New' || $ctrl.status == 'InProgress')"
                                             md-search-text="$ctrl.autocomplete['fleetManager']"
                                             md-selected-item-change="$ctrl.fleetManager = item.DisplayName; $ctrl.onchange('fleetmanagerchange', $ctrl.fleetManager)"
                                             md-no-cache="true"
                                             md-items="item in $ctrl.getDataOptions('employees','DisplayName', $ctrl.autocomplete['fleetManager'], 'fleet manager')"
                                             md-item-text="item.DisplayName"
                                             md-min-length="0"
                                             placeholder="Fleet Manager">
                                <md-item-template>
                                    <span md-highlight-text="$ctrl.autocomplete['fleetManager'].toUpperCase()">{{item.Name}} ({{item.EmplCode}})</span>
                                </md-item-template>
                                <md-not-found>
                                    No manager matching "{{$ctrl.autocomplete['fleetManager']}}" were found.
                                </md-not-found>
                            </md-autocomplete>
                        </div>

                    </div>
                    <div class="col-sm-4" ng-class="{ 'has-error' : $ctrl.auditForm.accountant.$invalid && ($ctrl.auditForm.accountant.$touched || $ctrl.auditForm.submitted) }">
                        <p class="text-muted">Accountant</p>
                        <!--<span ng-show="$ctrl.processing['accountant']" class="load-indicator glyphicon glyphicon-refresh" aria-hidden="true"></span>
                        <select ng-model="$ctrl.accountant" class="form-control" ng-init="$ctrl.getData('accountant');" required name="accountant" ng-disabled="!($ctrl.status == 'New' || $ctrl.status == 'InProgress')"
                                ng-options="option.EmplCode as option.Name for option in $ctrl.resources['accountant']"
                                ng-change="$ctrl.onchange('accountantchange', $ctrl.accountant)">
                            <option value="">select...</option>
                        </select>-->

                        <div ng-init="$ctrl.setAutocomplete('accountant', 'accountant')">
                            <md-autocomplete required
                                             md-input-name="accountant"
                                             ng-disabled="!($ctrl.status == 'New' || $ctrl.status == 'InProgress')"
                                             md-search-text="$ctrl.autocomplete['accountant']"
                                             md-selected-item-change="$ctrl.accountant = item.DisplayName; $ctrl.onchange('accountantchange', $ctrl.accountant)"
                                             md-no-cache="true"
                                             md-items="item in $ctrl.getDataOptions('employees','DisplayName', $ctrl.autocomplete['accountant'], 'accountant')"
                                             md-item-text="item.DisplayName"
                                             md-min-length="0"
                                             placeholder="Accountant">
                                <md-item-template>
                                    <span md-highlight-text="$ctrl.autocomplete['accountant'].toUpperCase()">{{item.Name}} ({{item.EmplCode}})</span>
                                </md-item-template>
                                <md-not-found>
                                    No manager matching "{{$ctrl.autocomplete['accountant']}}" were found.
                                </md-not-found>
                            </md-autocomplete>
                        </div>

                    </div>
                </div>
            </div>
        </div>

        <hr />

        <div class="panel-group" id="accordion" role="tablist" aria-multiselectable="true">

            <div class="panel panel-default" ng-repeat="block in $ctrl.data" ng-show="block.state.visible">
                <div class="panel-heading" role="tab" id="heading2">
                    <h2 class="panel-title">
                        <a role="button" data-toggle="collapse" data-parent="#accordion" data-target="#collapse-{{$index}}" aria-expanded="true" aria-controls="collapseOne" data-content="blockTitle">
                            {{::block.blockTitle}} <span class="hint">{{::block.blockHint}}</span>
                        </a>
                    </h2>
                </div>
                <div id="collapse-{{$index}}" class="panel-collapse collapse" ng-class="$index === 0 ? 'in' : ''" role="tabpanel" aria-labelledby="heading2">
                    <div class="panel-body">
                        <fieldset ng-disabled="!block.state.enabled">
                            <question-view ng-repeat="q in block.questions" question='q' cssclass='question'>
                            </question-view>

                            <table-view ng-repeat="t in block.tables" table='t'>
                            </table-view>
                        </fieldset>
                    </div>
                </div>
            </div>

        </div>

        <div class="text-right">
            <button type="submit" class="btn btn-default btn-blue" ng-click="$ctrl.save()" ng-disabled="$ctrl.readonly"><span class="glyphicon glyphicon-floppy-disk" aria-hidden="true"></span> Save</button>
            <button type="submit" class="btn btn-default btn-blue" onclick="window.print()"><span class="glyphicon glyphicon-print" aria-hidden="true"></span> Print</button>
            <button type="submit" class="btn btn-primary btn-blue" ng-click="$ctrl.submit()" ng-disabled="$ctrl.readonly" ng-hide="$ctrl.workflowDisabled"><span class="glyphicon glyphicon-ok" aria-hidden="true"></span> Submit</button>
        </div>
    </div>

    <div class="processing" ng-show="$ctrl.loading">Working...</div>
    <div class="mask" ng-show="$ctrl.loading"></div>

</div>

<script>
    $(function () {
        $('#accordion').on('hidden.bs.collapse', function () {
            $('.panel-collapse').height('auto');
        })
    })
</script>